connector:
  - id: in
    type: file
    preprocessors:
      - lines
    codec: json
    config:
      path: "in.json"
      mode: "read"
  - id: exit
    type: exit
  - id: out
    type: file
    codec: json-sorted
    postprocessors:
      - lines
    config:
      path: "events.log"
      mode: "truncate"

binding:
  - id: test
    links:
      "/connector/in/{instance}/out": ["/pipeline/main/{instance}/in"]
      "/pipeline/main/{instance}/out": ["/connector/out/{instance}/in"]
      "/pipeline/main/{instance}/exit": ["/connector/exit/{instance}/in"]

      # logging onramp errors (eg: codec failures) to stderr as well
      # we also log the same as part of tremor logging right now but if
      # we choose to remove that, this will give us visibility for the same
      # (not relying on this only right now, since the asserts for this test
      # don't pass consistently with this only currently)
      "/connector/in/{instance}/err": ["/pipeline/system::passthrough/{instance}/in"]
      "/pipeline/system::passthrough/{instance}/out": ["/connector/system::stdio/system/in"]

mapping:
  /binding/test/1:
    instance: "1"
