connector:
  - id: input
    type: cb
    codec: json
    preprocessors:
      - lines
    config:
      path: "in.json"
      timeout: 10000
      expect_batched: true
  - id: elastic
    type: elastic
    config:
      nodes:
        - "http://127.0.0.1:9200/"
      include_payload_in_response: true
  - id: errfile
    type: file
    codec: json-sorted
    postprocessors:
      - lines
    config:
      path: "err.log"
      mode: "truncate"
  - id: okfile
    type: file
    codec: json-sorted
    postprocessors:
      - lines
    config:
      path: "ok.log"
      mode: "truncate"

binding:
  - id: elastic_integration
    links:
      "/connector/input/{instance}/out": ["/pipeline/main/{instance}/in"]
      "/pipeline/main/{instance}/out": ["/connector/elastic/{instance}/in"]

      "/connector/elastic/{instance}/out":
        ["/pipeline/response_handling/{instance}/in"]
      "/pipeline/response_handling/{instance}/out":
        ["/connector/okfile/{instance}/in"]

      "/connector/elastic/{instance}/err":
        ["/pipeline/response_handling/{instance}/in"]
      "/pipeline/response_handling/{instance}/err":
        ["/connector/errfile/{instance}/in"]

mapping:
  "/binding/elastic_integration/01":
    instance: "01"
