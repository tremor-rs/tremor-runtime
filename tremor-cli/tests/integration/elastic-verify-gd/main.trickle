define script process_batch_item
script
  # setting required metadata for elastic
  let $elastic = {
    "_index": "my_little_index",
    "action": event.action
  };
  let $correlation = event.snot;
  match event of
    case %{present doc_id} => let $elastic["_id"] = event.doc_id
    default => null
  end;
  event
end;
create script process_batch_item;

define generic::batch operator batch with
  count = 6
end;
create operator batch;

define script process_whole_batch
script
  let $elastic = {
    "_type": "my_little_doc"
  };
  event
end;
create script process_whole_batch;

select event from in into process_batch_item;
select event from process_batch_item into batch;
select event from batch into process_whole_batch;
select event from process_whole_batch into out;

select event from process_batch_item/err into err;
select event from process_whole_batch/err into err;